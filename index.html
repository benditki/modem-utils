<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <title>Modem Utils</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="anim.css">
    </head>

    <body>

    <div id="container"></div>
 
    <script id='header-tpl' type='text/ractive'>

    <nav class="back"></nav>
    <nav>
        <h1><span class="A">.</span><span class="B">M</span><span class="C">U</span><span class="D">.</span></h1>
        {{#each sections}}
        <a on-click="@.set('active_section', name)" class="{{active_section == name? 'active' : ''}}"><i>{{{icon}}}</i>{{name}}</a>
        {{/each}}
    </nav>

    <header id="header">
        <button on-click=['scan_ports']><i>&#xe6c2;</i>Scan</button>
        
        {{#if ports}}
        <div id="ports-wrap" class="select-wrap">
        <select id="ports" value="{{selected_port}}">
        {{#each ports}}
            <option value="{{comName}}">{{comName + ": " + manufacturer + (serialNumber ? "-" + serialNumber : "")}}</option>
        {{/each}}
        </select>
        </div>
        
        {{#if connecting}}
        <button on-click="['abort']"><i>&#xe681;</i>Abort</button>
        {{elseif connected_port != selected_port}}
        <button on-click="['connect', selected_port]"><i>&#xe624;</i>Connect</button>
        {{elseif connected_port}}
        <button on-click="['disconnect']"><i>&#xe681;</i>Disconn</button>
        <button on-click="['connect', connected_port]"><i>&#xe61c;</i>Reconn</button>
        {{/if}}
        
        {{else}}
        No ports discovered
        {{/if}}
        
        {{#if scan_error}}{{scan_error.message}}{{/if}}
    </header>

    <main>
        <section class="{{active_section == 'modem'? 'active' : ''}}">
            <h1>Modem configuration and state</h1>
            {{#if connected_port && modem}}
            <table>
            <tr><th colspan="2">Modem parameters</th></tr>
            <tr><td>Model:</td><td>{{modem.model}}</td></tr>
            <tr><td>SN:</td><td>{{modem.sn}}</td></tr>
            <tr><th colspan="2">SIM card</th></tr>
            {{#if sim}}
            <tr><td>ID:</td><td>{{sim.id}}</td></tr>
            {{#if operator}}
            <tr><th colspan="2">Network</th></tr>
            <tr><td>Operator</td><td>{{operator}}</td></tr>
            <tr><td>Type</td><td>{{network}}</td></tr>
            {{#if current_apn}}
            <tr><th colspan="2">Connection</th></tr>
            <tr><td>APN</td><td><input value="{{current_apn}}">{{#if current_apn != stored_apn}}<button on-click=['store_apn']><i>&#xe65c;</i>Store</button>{{/if}}</td></tr>
            <tr><td>Predefined IP</td><td>{{stored_ip}}</td></tr>
            {{#if current_ip}}
            <tr><td>Received IP</td><td>{{current_ip}}</td></tr>
            {{else}}
            <tr><td colspan="2" style="text-align:center">{{{@.waiting("Activating GPRS")}}}</td></tr>
            {{/if}}
            {{/if}}
            {{else}}
            <tr><td colspan="2" style="text-align:center">{{{@.waiting("Registering to the network")}}}</td></tr>
            {{/if}}
            {{else}}
            <tr><td colspan="2">no SIM is inserted</td></tr>
            {{/if}}
            <tr><td></td><td></td></tr>
            </table>
            {{/if}}
        </section>
        {{#if connected_port}}
        <section class="{{active_section == 'cloud'? 'active' : ''}}">
            <h1>Cloud connectivity tests</h1>
            <form>
                <select value="{{method}}"><option>GET</option></select>
                <input value="{{url}}">
                <button type="button" on-click="['http', method, url]">
                    {{#if sending}}<i class="loader"></i>{{else}}<i>&#xe629;</i>{{/if}}Send
                </button>
                <output>
                    {{#if http_error}}<p class="error"><i class="bad">&#xe681;</i>{{http_error}}</p>{{/if}}
                    {{#if http_response}}<pre>{{http_response}}</pre>{{/if}}
                </output>
            </form>
        </section>
        <section class="{{active_section == 'certificates'? 'active' : ''}}">
            <h1>Certificate tests</h1>
            {{#with cert}}
            <form on-change="@context.set('.checked', false)">
                <select value="{{type}}">
                    <option value="0">Root CA certificate</option>
                    <option value="1">Client certificate</option>
                    <option value="2">Client private key</option>
                </select>
                <input type="file" name="file" hidden on-change="['update_cert_path']">
                <input class="file" name="file_path" placeholder="Enter file name" value="{{cert.path}}">
                <button type="button" class="narrow" onclick="file.click()"><i>&#xe632;</i></button>
                {{#if path}}
                {{#if checked}}
                <output>
                {{#if valid}}
                <i class="good">&#xe66c;</i><tt>{{md5}}</tt>
                {{else}}
                <i class="bad">&#xe681;</i><span class="bad">Invalid certificate</span>
                {{/if}}
                </output>
                {{else}}
                <button type="button" on-click="['validate_cert']"><i>&#xe685;</i>Validate</button>
                {{/if}}
                {{/if}}
            </form>
            {{/with}}
        </section>
        {{/if}}
    </main>
    
    <footer>
        <div id="log"></div>
    </footer>
    
    <div id="grid" class="{{grid_visible? 'shown' : ''}}"></div>
    <button id="grid-toggle" on-click="@.toggle('grid_visible')" class="{{grid_visible? 'off' : ''}}">##</button>

    </script>
    

    </body>

    <script>
    require('./renderer.js')
    </script>
</html>
