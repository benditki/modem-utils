<!DOCTYPE html>
<html>
    <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="anim.css">
    </head>

    <body>
    </body>

    <script id='page-tpl' type='text/ractive'>
    <header>
        <h1><span class="A">.</span><span class="B">M</span><span class="C">U</span><span class="D">.</span><span class="E">BENCH</span></h1>
        <a on-click="open_settings"><i>&#xe666;</i></a>
    </header>
    
    <main>
    <table id="batch-table">
    <tr><th></th>     {{#each gsm: port_name}}<td class="space"></td><th class="port-name inner"  class="{{state_class(this)}}">{{port_name}}</th>{{/each}}</tr>
    <tr><th>Baudrate</th> {{#each gsm: port_name}}<td class="space"></td><td class="inner baudrate" class="{{state_class(this)}}">{{#if state==0}} {{{@.carousel()}}} {{elseif state>0}} {{active_baudrate}} {{/if}}</td>{{/each}}</tr>
    <tr><th>Model</th>    {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==2}}                                   {{elseif state>2}} {{model}}           {{/if}}</td>{{/each}}</tr>
    <tr><th>SN</th>       {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==2}}                                   {{elseif state>2}} {{sn}}              {{/if}}</td>{{/each}}</tr>
    <tr><th>APN</th>      {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==3}} {{{@.waiting("Configuring")}}}    {{elseif state>3}} {{apn}}             {{/if}}</td>{{/each}}</tr>
    <tr><th>Static IP</th>{{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==3}}                                   {{elseif state>3}} {{static_ip}}       {{/if}}</td>{{/each}}</tr>
    <tr><th>Sim</th>      {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==3}}                                   {{elseif state>3}} {{#if sim_id}} {{sim_id}} {{/if}} {{/if}}</td>{{/each}}</tr>
    <tr><th>Operator</th> {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==5}} {{{@.waiting("Registering")}}}    {{elseif state>5}} {{operator}}        {{/if}}</td>{{/each}}</tr>
    <tr><th>Network</th>  {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==5}}     {{elseif state>5}} {{network}}         {{/if}}</td>{{/each}}</tr>
    <tr><th>IP</th>       {{#each gsm: port_name}}<td class="space"></td><td class="inner" class="{{state_class(this)}}">{{#if state==6}} {{{@.waiting("Acivating Data")}}} {{elseif state>6}} {{current_ip}}      {{/if}}</td>{{/each}}</tr>
    <tr><th></th>         {{#each gsm: port_name}}<td class="space"></td><td class="result inner" class="{{state_class(this)}}">
        {{#if done}}
        {{#if state==7}}   <output> <i class="good">&#xe66c;</i> Done</output>
        {{elseif !sim_id}} <output> <i class="warn">&#xe67b;</i> No sim</output> {{/if}}
        {{#if settings.mode == "bench"}}
        {{#if restart_ts}} <output class="action" on-click="['restart', port_name]"><!--<i>&#xe61c;</i>-->{{@.format_countdown(restart_ts)}} Restart </output> {{/if}}
        {{/if}}
        {{/if}}
    </td>{{/each}}</tr>
    {{#if settings.mode == "bench"}}
    <tr class="stats-title"><th>Statistics</th>  {{#each gsm: port_name}}<td class="space"></td><td class="space"></td>{{/each}}</tr>
    <!--<tr><th>Test</th>{{#each gsm: port_name}}<td class="space"></td><td class="space">{{#with sim_stats(sim_id)}}{{test.length}}{{else}}_0_{{/with}}</td>{{/each}}</tr>-->
    <tr><th>Attempts</th>{{#each gsm: port_name}}<td class="space"></td><td class="space">{{#with sim_stats(sim_id)}}{{#if attempts}}{{attempts.length}}{{else}}0{{/if}}{{/with}}</td>{{/each}}</tr>
    <tr><th>Registration</th>{{#each gsm: port_name}}<td class="space"></td><td class="space">{{#with sim_stats(sim_id)}}{{regist_avg(attempts).toFixed(1)}} sec{{/with}}</td>{{/each}}</tr>
    <tr><th>Acquire IP</th>  {{#each gsm: port_name}}<td class="space"></td><td class="space">{{#with sim_stats(sim_id)}}{{acq_ip_avg(attempts).toFixed(1)}} sec{{/with}}</td>{{/each}}</tr>
    <tr class="regist-log"><th>Logs <i on-click="save_reg_logs">&#xe65c;</i></th>        {{#each gsm: port_name}}<td class="space"></td><td class="space">
        {{#with sim_stats(sim_id)}}
        {{#each ./logs}}
        <p><span class="time">{{format_time(ts)}}</span> {{msg}}
        {{#if duration}}<span class="duration">({{duration}} sec)</span>{{/if}}</p>
        {{/each}}
        {{/with}}
    </td>{{/each}}</tr>
    {{/if}}
    </table>
    </main>
    
    <footer>
        <div id="log">
        <ul>
        <li><a class-shown="all_logs_shown()" on-click="toggle_all_logs">ALL</a></li>
        {{#each logs as items: port_name}}<li><a class-shown="@.get('show_log.' + port_name)" on-click="@.toggle('show_log.' + port_name)">{{port_name}}</a></li>{{/each}}
        </ul>
        {{#each logs as items: port_name}}
            {{#if @.get('show_log.' + port_name)}}
            {{#each items.slice(-6)}}
                <p class-error="error" class-sent="type=='out'" class-received="type=='in'">{{port_name}}: {{#if type=="in"}}&lt;{{elseif type=="out"}}&gt;{{/if}} {{msg}}</p>
            {{/each}}
            {{/if}}
        {{else}}
        no logs
        {{/each}}
        </div>
    </footer>

    
    <div id="grid" class="{{grid_visible? 'shown' : ''}}"></div>
    <button id="grid-toggle" on-click="@.toggle('grid_visible')" class="{{grid_visible? 'off' : ''}}">##</button>

    </script>

    <script>
    require('./batch.js')
    </script>
</html>
